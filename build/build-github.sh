:://///////////////////////////////////////////////////////////////////////////
:: AG Development Framework.
:: Copyright 2011-2020 GeorgeAth. All Rights Reserved.
:://///////////////////////////////////////////////////////////////////////////
@echo off
cls
setlocal
:://///////////////////////////////////////////////////////////////////////////

:://///////////////////////////////////////////////////////////////////////////
:: Enviroment Variables
set "AG_BUILD_TYPE=Release"
set "AG_DIR_BUILD=build"
set "AG_DIR_LIB=AG-LIB"
set "AG_DIR_DEV=AG-DEV"
:://///////////////////////////////////////////////////////////////////////////

:://///////////////////////////////////////////////////////////////////////////
:: Print current directory (source).
echo Current directory (source) : %CD%
:://///////////////////////////////////////////////////////////////////////////
:: Change directory to root.
cd ../
echo Current directory (root) : %CD%
:: Ensure required folders exist.
if not exist %AG_DIR_LIB% ( echo lib not found. && goto ABORT_OPERATION )
if not exist %AG_DIR_DEV% ( echo dev not found. && goto ABORT_OPERATION )
:://///////////////////////////////////////////////////////////////////////////
:: Ensure build directory not exist.
if exist %AG_DIR_BUILD% ( echo build exist. && goto ABORT_OPERATION )
:: Create build directory.
mkdir %AG_DIR_BUILD%
:: Change directory to build.
cd %AG_DIR_BUILD%
echo Current directory (build) : %CD%
:://///////////////////////////////////////////////////////////////////////////

:://///////////////////////////////////////////////////////////////////////////
:: Build the cmake command.
SET "AG_CMAKE_CMD=cmake ../%AG_DIR_DEV%"
::-----------------------------------------------------------------------------

::-----------------------------------------------------------------------------
:: Print the cmake command
echo CMake Command : %AG_CMAKE_CMD%
:://///////////////////////////////////////////////////////////////////////////


:://///////////////////////////////////////////////////////////////////////////
:: Ensure CMake is installed.
cmake --version

%AG_CMAKE_CMD%

cmake --build . --config %AG_BUILD_TYPE%

ctest -C %AG_BUILD_TYPE%

:://///////////////////////////////////////////////////////////////////////////


:://///////////////////////////////////////////////////////////////////////////
:EXIT_SCRIPT
:: Exit this batch script with error level equal to 0.
exit /b 0
:://///////////////////////////////////////////////////////////////////////////
:ABORT_OPERATION
echo Operation aborted.
:: Exit this batch script with error level equal to 1.
exit /b 1
:://///////////////////////////////////////////////////////////////////////////
