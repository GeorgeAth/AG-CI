:://///////////////////////////////////////////////////////////////////////////
:: AG Development Framework.
:: Copyright 2011-2020 GeorgeAth. All Rights Reserved.
:://///////////////////////////////////////////////////////////////////////////
@echo off
cls
setlocal
:://///////////////////////////////////////////////////////////////////////////

:://///////////////////////////////////////////////////////////////////////////
:: Enviroment Variables
set "AG_BUILD_TYPE=Release"
set "AG_DIR_OUT=build"
set "AG_DIR_SRC=AG-DEV"
set "AG_DIR_DEP=AG-LIB"
:://///////////////////////////////////////////////////////////////////////////

:://///////////////////////////////////////////////////////////////////////////
:: Print current script.
echo file : %0
:: Print the current directory (expected to be root->sub-module).
echo home : %CD%
:: Change directory to root.
cd ../
echo root : %CD%
:: Ensure required folders exist.
if not exist %AG_DIR_SRC% ( echo src not found. && goto ABORT_OPERATION )
if not exist %AG_DIR_DEP% ( echo dep not found. && goto ABORT_OPERATION )
:://///////////////////////////////////////////////////////////////////////////
:: Ensure output directory does not exist.
if exist %AG_DIR_OUT% ( echo out %AG_DIR_OUT% exist. && goto ABORT_OPERATION )
:: Create output directory.
mkdir %AG_DIR_OUT%
:: Change directory to output.
cd %AG_DIR_OUT%
echo output : %CD%
:://///////////////////////////////////////////////////////////////////////////

:://///////////////////////////////////////////////////////////////////////////
:: Build the cmake create command.
SET "AG_CMD_CREATE=cmake ../%AG_DIR_SRC%"
::-----------------------------------------------------------------------------
:: Build the cmake build command.
SET "AG_CMD_BUILD=cmake --build . --config %AG_BUILD_TYPE%"
::-----------------------------------------------------------------------------
:: Build the cmake test command.
SET "AG_CMD_TEST=ctest -C %AG_BUILD_TYPE%"
:://///////////////////////////////////////////////////////////////////////////

:://///////////////////////////////////////////////////////////////////////////
:: Print cmake command.
echo cmake create command : %AG_CMD_CREATE%
echo cmake build command : %AG_CMD_BUILD%
echo cmake test command : %AG_CMD_TEST%
:://///////////////////////////////////////////////////////////////////////////

:: Ensure cmake is installed.
::cmake --version

:://///////////////////////////////////////////////////////////////////////////
:: Run the cmake-create command.
%AG_CMD_CREATE%
:: Run the cmake-build command.
%AG_CMD_BUILD%
:: Run the cmake-test command.
%AG_CMD_TEST%
:://///////////////////////////////////////////////////////////////////////////


:://///////////////////////////////////////////////////////////////////////////
:EXIT_SCRIPT
:: Exit this batch script with error level equal to 0.
exit /b 0
:://///////////////////////////////////////////////////////////////////////////
:ABORT_OPERATION
echo Operation aborted.
:: Exit this batch script with error level equal to 1.
exit /b 1
:://///////////////////////////////////////////////////////////////////////////
